rulesetId: okham.otc.base
version: 0.1.0
description: Strict baseline lint rules for OTC type definitions
rules:
  - ruleId: OTC-REQ-001
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: required_field
    params:
      path: "/otc"
    message: OTC type must declare otc version

  - ruleId: OTC-OTC-001
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: pattern_match
    params:
      path: "/otc"
      pattern: "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"
    message: OTC version must be semantic version

  - ruleId: OTC-OTC-002
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: pattern_match
    params:
      path: "/otc"
      expected: "0.2.0"
    message: "OTC types must declare otc: \"0.2.0\" (current canonical)"

  - ruleId: OTC-REQ-002
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: required_field
    params:
      path: "/id"
    message: OTC type must declare id

  - ruleId: OTC-REQ-003
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: required_field
    params:
      path: "/name"
    message: OTC type must declare name

  - ruleId: OTC-REQ-004
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: required_field
    params:
      path: "/description"
    message: OTC type must declare description

  - ruleId: OTC-REQ-005
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: required_field
    params:
      path: "/fields"
    message: OTC type must declare fields

  - ruleId: OTC-REQ-006
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: required_field
    params:
      path: "/fields/0/name"
    message: OTC type must declare at least 1 field

  - ruleId: OTC-REQ-007
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: required_field
    params:
      path: "/version"
    message: OTC type must declare version

  - ruleId: OTC-REQ-008
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: required_field
    params:
      path: "/status"
    message: OTC type must declare status (draft|stable|deprecated)

  - ruleId: OTC-STATUS-001
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: pattern_match
    params:
      path: "/status"
      pattern: "^(draft|stable|deprecated)$"
    message: OTC type status must be draft|stable|deprecated

  - ruleId: OTC-UNIQ-001
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: unique_field
    params:
      path: "/id"
    message: OTC type ids must be unique

  - ruleId: OTC-FIELD-001
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: required_field
    params:
      path: "/fields/*/name"
      requireAll: true
    message: Each OTC field must declare name

  - ruleId: OTC-FIELD-002
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: required_field
    params:
      path: "/fields/*/type"
      requireAll: true
    message: Each OTC field must declare type

  - ruleId: OTC-FIELD-003
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: required_field
    params:
      path: "/fields/*/description"
      requireAll: true
    message: Each OTC field must declare description

  - ruleId: OTC-FIELD-004
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: required_field
    params:
      path: "/fields/*/required"
      requireAll: true
    message: Each OTC field must declare required (boolean)

  - ruleId: OTC-FIELD-005
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: pattern_match
    params:
      path: "/fields/*/required"
      pattern: "^(true|false)$"
    message: Each OTC field required must be boolean

  - ruleId: OTC-FIELD-006
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: pattern_match
    params:
      path: "/fields/*/name"
      pattern: "^[a-z][a-z0-9]*([A-Z][a-z0-9]*)*$"
    message: OTC field names must be camelCase

  - ruleId: OTC-FIELD-007
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: pattern_match
    params:
      path: "/fields/*/type"
      pattern: "^(string|number|integer|boolean|object|array|okham\\.[a-z0-9]+(\\.[a-z0-9]+)+)$"
    message: OTC field type must be a primitive or a namespaced okham.* type id

  - ruleId: OTC-REF-001
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: ref_exists
    params:
      path: "/extends"
      registry: "otc.types"
    message: OTC extends type must exist in OTC registry (if provided)

  - ruleId: OTC-REF-002
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: ref_exists
    params:
      path: "/mixins/*"
      registry: "otc.types"
    message: OTC mixin types must exist in OTC registry

  - ruleId: OTC-DEP-001
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: required_if
    params:
      whenPath: "/status"
      whenEquals: "deprecated"
      path: "/deprecatedReason"
    message: deprecatedReason is required when status is deprecated

  - ruleId: OTC-SCHEMA-001
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: schema_matches_fields
    params:
      fieldsPath: "/fields"
      schemaPath: "/schema"
    message: If schema is present, it must match fields (properties + required)

  - ruleId: OTC-ID-001
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: pattern_match
    params:
      path: "/id"
      pattern: "^okham\\.[a-z0-9]+(\\.[a-z0-9]+)+$"
    message: OTC type ids must use okham.* dotted lowercase format

  - ruleId: OTC-VERSION-001
    severity: error
    scope: otc
    selector:
      globs:
        - "**/types/**/*.{yaml,yml,json}"
        - "**/catalog/types/**/*.{yaml,yml,json}"
      documentKind: type
    assert: pattern_match
    params:
      path: "/version"
      pattern: "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$"
    message: OTC type version must be semantic version
